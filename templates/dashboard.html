<!-- templates/dashboard.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NexaAI — Dashboard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
</head>
<body>
  <nav class="top-nav">
    <div class="nav-left">
      <button onclick="UI.toggleSidebar()" title="Toggle sidebar">☰</button>
      <button onclick="UI.createNewChat()">New chat</button>
      <div class="model-selector">
        <button id="model-btn" onclick="Models.toggleSelector()">
          <span id="selected-model">{{ models[session.get('selected_model','gemini-flash')].name }}</span> ▾
        </button>
        <div id="model-list" class="hidden model-list"></div>
      </div>
    </div>
    <div class="nav-right">
      {% if not user.is_premium %}
        <button class="upgrade" onclick="location.href='/checkout'">Upgrade ★</button>
      {% else %}
        <span class="premium">★ Premium</span>
      {% endif %}
      <button onclick="UI.toggleUserMenu()">
        <span class="avatar">{{ user.name[0].upper() }}</span>
      </button>
    </div>
  </nav>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-top">
      <h3>Chats</h3>
      <div id="chat-history"></div>
    </div>
    <div class="sidebar-bottom">
      <button onclick="Router.load('projects')">Projects</button>
      <button onclick="Router.load('canvas')">Canvas</button>
      <button onclick="Router.load('files')">Files</button>
      <button onclick="Router.load('memory')">Memory</button>
      <button onclick="Router.load('voice')">Voice</button>
      <button onclick="Router.load('settings')">Settings</button>
      <button id="export-btn" onclick="Export.exportChats()">Export</button>
    </div>
  </aside>

  <main id="main" class="main">
    <!-- main content area: subviews are loaded here -->
    <div id="view-container"></div>
  </main>

  <!-- Hidden templates / placeholders -->
  <template id="loading-tpl">
    <div class="loading">Loading…</div>
  </template>

  <script>
    // Pass server-side models to client
    window.NEXA = {
      currentUser: {{ {'id': user.id, 'name': user.name, 'is_premium': user.is_premium} | tojson }},
      models: {{ models | tojson }},
      selectedModel: "{{ session.get('selected_model','gemini-flash') }}"
    };
  </script>

  <script src="{{ url_for('static', filename='js/ai_models.js') }}"></script>
  <script src="{{ url_for('static', filename='js/file_tools.js') }}"></script>
  <script src="{{ url_for('static', filename='js/canvas.js') }}"></script>
  <script src="{{ url_for('static', filename='js/voice.js') }}"></script>
  <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
</body>
</html>
